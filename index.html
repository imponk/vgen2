
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reels Generator Fast Light</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{margin:0;padding:16px;display:flex;gap:16px;background:#0f172a;color:#e5e7eb;font-family:'Plus Jakarta Sans',sans-serif}
.panel{background:#020617;padding:16px;border-radius:12px;width:360px}
.right{flex:1;display:flex;justify-content:center;align-items:center}
textarea{width:100%;min-height:60px;background:#020617;color:white;border:1px solid #333;border-radius:8px;padding:8px}
button{padding:8px 16px;border-radius:20px;border:none;margin-top:8px;cursor:pointer}
.btn-primary{background:#2563eb;color:white}
canvas{background:#999;border-radius:20px;box-shadow:0 0 20px #000}
</style>
</head>
<body>
<div class="panel">
<h2>Reels Generator</h2>
<label>Upper</label><textarea id="upper"></textarea>
<label>Judul</label><textarea id="title"></textarea>
<label>Subjudul</label><textarea id="subtitle"></textarea>
<label>Isi</label><textarea id="body"></textarea>
<button class="btn-primary" id="preview">Preview</button>
<button class="btn-primary" id="render">Render</button>
<div id="download"></div>
</div>
<div class="right"><canvas id="c" width="1080" height="1920"></canvas></div>

<script>
const c=document.getElementById("c"),ctx=c.getContext("2d");
const upper=document.getElementById("upper"),title=document.getElementById("title"),
subtitle=document.getElementById("subtitle"),body=document.getElementById("body");
let pages=[],pageDur=[];
const TITLE_PRE_HOLD=1.0,TITLE_FADE=0.6,TITLE_WIPE=0.8,TITLE_STATIC=1.0;
const fadeInDur=0.3,wipeDur=0.4,highlightWipeDur=0.8;

function wrap(t,max){let w=t.split(" "),l=[w[0]];let i=1;for(;i<w.length;i++){let test=l[l.length-1]+" "+w[i];if(ctx.measureText(test).width>max){l.push(w[i]);}else l[l.length-1]=test;}return l;}

function tokenize(t){let a=[],cur="",hi=false,i=0;function push(){if(cur.length)a.push({t:cur,h:hi});cur="";}while(i<t.length){if(!hi&&t.startsWith("[[",i)){push();hi=true;i+=2;}
else if(hi&&t.startsWith("]]",i)){push();hi=false;i+=2;}
else{cur+=t[i];if(t[i]==" ")push();i++;}}
push();return a;}

function drawLine(tokens,x,y,prog){let full=tokens.map(o=>o.t).join("");let idx=0;
for(let o of tokens){let wBefore=ctx.measureText(full.slice(0,idx)).width;
let wInside=ctx.measureText(o.t).width;
if(o.h&&o.t.trim()){let vis=wInside*prog;
ctx.fillStyle="#0088d8";ctx.fillRect(x+wBefore-4,y-40,vis+8,52);}
idx+=o.t.length;}
ctx.fillStyle="#fff";ctx.fillText(full,x,y);
}

function drawRich(t,x,y,max,lineGap,prog){
let tok=tokenize(t),lines=[],cur=[],ct="";
for(let o of tok){
 let test=ct+o.t;
 if(ct&&ctx.measureText(test).width>max){lines.push(cur);cur=[o];ct=o.t;}
 else{cur.push(o);ct=test;}
}
if(cur.length)lines.push(cur);
for(let ln of lines){drawLine(ln,x,y,prog);y+=lineGap;}
return y;
}

function splitPages(){
pages=[];let lines=body.value.split("\n"),p=[];
for(let l of lines){
 if(!l.trim()){if(p.length){pages.push(p);p=[];}}
 else p.push(l);
}
if(p.length)pages.push(p);
if(!pages.length)pages=[[]];
}

function computeDur(){
splitPages();pageDur=[];
for(let p of pages){
 let txt=p.join(" ").replace(/\s+/g,"");let ch=txt.length;
 let d=2.5+ch*0.035;if(d<3)d=3;if(d>10)d=10;
 pageDur.push(d);
}
}

function bg(){ctx.fillStyle="#999";ctx.fillRect(0,0,c.width,c.height);}

function drawTitle(t){
bg();
let ml=110,mr=140,w=c.width-ml-mr;
let y=c.height-560;
let up=upper.value.trim(),ti=title.value.trim(),sub=subtitle.value.trim();
let animCore=Math.max(TITLE_FADE,TITLE_WIPE);
let total=TITLE_PRE_HOLD+animCore+TITLE_STATIC;
let alpha=1,wipe=1;

if(t<TITLE_PRE_HOLD){alpha=1;wipe=1;}
else{
 let a=t-TITLE_PRE_HOLD;
 if(a<=TITLE_FADE){
   let p=a/TITLE_FADE;alpha=p*p*(3-2*p);
 } else alpha=1;
 if(a<=TITLE_WIPE)wipe=Math.min(1,a/TITLE_WIPE);
}

ctx.save();ctx.globalAlpha=alpha;
ctx.beginPath();ctx.rect(0,0,ml+w*wipe,c.height);ctx.clip();
ctx.textAlign="left";

if(up){
 ctx.font="700 34px 'Plus Jakarta Sans'";let L=wrap(up,w);
 for(let ln of L){ctx.fillText(ln,ml,y);y+=36;}y+=22;
}

if(ti){
 ctx.font="400 104px 'DM Serif Display'";let L=wrap(ti,w);
 for(let ln of L){ctx.fillText(ln,ml,y);y+=104;}y+=12;
}

if(sub){
 ctx.font="700 34px 'Plus Jakarta Sans'";let L=wrap(sub,w);
 for(let ln of L){ctx.fillText(ln,ml,y);y+=36;}
}

ctx.restore();
}

function drawPage(i,t,sd){
bg();
let ml=110,mr=140,max=c.width-ml-mr;
let alpha=1;if(t<fadeInDur)alpha=t/fadeInDur;
else if(sd-t<0.5)alpha=(sd-t)/0.5;
alpha=Math.max(0,Math.min(1,alpha));
let wipeP=1;if(t<wipeDur)wipeP=t/wipeDur;
let hP=1;if(t<highlightWipeDur)hP=t/highlightWipeDur;
ctx.save();ctx.globalAlpha=alpha;
ctx.beginPath();ctx.rect(0,0,ml+max*wipeP,c.height);ctx.clip();
ctx.font="700 56px 'Plus Jakarta Sans'";
let y=c.height-600;
for(let ln of pages[i]){
 if(!ln.trim()){y+=40;continue;}
 y=drawRich(ln,ml,y,max,64,hP);
}
ctx.restore();
}

function frame(t){
let animCore=Math.max(TITLE_FADE,TITLE_WIPE);
let titleTotal=TITLE_PRE_HOLD+animCore+TITLE_STATIC;
let gap=titleTotal+1.0;
if(t<titleTotal)return drawTitle(t);
if(t<gap)return bg();
let tt=t-gap;
let acc=0;
for(let i=0;i<pages.length;i++){
 let d=pageDur[i];
 if(tt<acc+d)return drawPage(i,tt-acc,d);
 acc+=d;
}
drawPage(pages.length-1,pageDur[pages.length-1]-0.001,pageDur[pages.length-1]);
}

let start,previewing=false;
function loop(ts){
 if(!previewing)return;
 if(!start)start=ts;
 let t=(ts-start)/1000;
 frame(t);
 requestAnimationFrame(loop);
}

document.getElementById("preview").onclick=()=>{
 computeDur();previewing=true;start=null;requestAnimationFrame(loop);
};

</script>
</body>
</html>
